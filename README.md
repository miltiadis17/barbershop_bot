# Telegram-бот для барбершопа

Бот для записи клиентов в барбершоп с возможностью выбора услуги, мастера, даты и времени.

## Возможности

### Для клиентов:
- `/start` - начать запись на услугу
- `/my_bookings` - просмотр своих записей и отмена записи
- Пошаговый процесс записи:
  1. Выбор услуги
  2. Выбор мастера
  3. Выбор даты (из ближайших 14 дней)
  4. Выбор времени (только свободные 30-минутные слоты)

### Для администраторов:
- `/bookings` - просмотр записей на выбранный день
- Автоматическая очистка записей старше 3 дней (каждый день в 03:00)

## Структура проекта

```
barbershop_bot/
├── main.py                  # Главный файл запуска бота
├── config.py               # Конфигурация (токен, БД, графики мастеров)
├── requirements.txt        # Зависимости
├── .env.example           # Пример файла с переменными окружения
├── database/              # Модуль работы с БД
│   ├── __init__.py
│   ├── connection.py      # Подключение к PostgreSQL
│   ├── models.py          # Модели данных (услуги, записи)
│   └── init_data.py       # Инициализация начальных данных
├── handlers/              # Обработчики команд
│   ├── __init__.py
│   ├── client_handlers.py # Обработчики для клиентов
│   └── admin_handlers.py  # Обработчики для админов
├── keyboards/             # Клавиатуры
│   ├── __init__.py
│   └── inline_keyboards.py # Inline клавиатуры
└── utils/                 # Вспомогательные функции
    ├── __init__.py
    └── helpers.py         # Функции для работы с расписанием
```

## Установка

### 1. Требования
- Python 3.10+
- PostgreSQL 12+

### 2. Клонирование и установка зависимостей

```bash
cd barbershop_bot
pip install -r requirements.txt
```

### 3. Настройка PostgreSQL

Создайте базу данных:

```sql
CREATE DATABASE barbershop_bot;
```

### 4. Настройка переменных окружения

Скопируйте `.env.example` в `.env` и заполните:

```bash
cp .env.example .env
```

Отредактируйте `.env`:

```env
BOT_TOKEN=your_bot_token_here
DB_HOST=localhost
DB_PORT=5432
DB_NAME=barbershop_bot
DB_USER=postgres
DB_PASSWORD=your_password_here
```

### 5. Настройка админов

Откройте `config.py` и добавьте свой Telegram user_id в список `ADMIN_IDS`:

```python
ADMIN_IDS = [
    123456789,  # Замените на свой user_id
]
```

Чтобы узнать свой user_id, используйте бота [@userinfobot](https://t.me/userinfobot).

### 6. Настройка услуг (опционально)

Начальные услуги задаются в `database/init_data.py`:

```python
services = [
    "Стрижка",
    "Борода",
    "Комплекс (стрижка + борода)",
]
```

### 7. Настройка графиков мастеров (опционально)

График работы мастеров настраивается в `config.py`:

```python
MASTERS_SCHEDULE = {
    "Иван": {
        "days": [0, 1, 5, 6],  # ПН, ВТ, СБ, ВС (0=ПН, 6=ВС)
        "start": "12:00",
        "end": "21:00"
    },
    # ...
}
```

## Запуск

```bash
cd barbershop_bot
python main.py
```

## Использование

### Клиент:

1. Отправьте `/start` боту
2. Выберите услугу из списка
3. Выберите мастера
4. Выберите дату
5. Выберите свободное время
6. Получите подтверждение записи

Для просмотра своих записей: `/my_bookings`

### Администратор:

Отправьте `/bookings` и выберите дату для просмотра записей.

## Технические детали

### База данных

Структура таблиц:

**services** - услуги
- id (SERIAL PRIMARY KEY)
- name (VARCHAR(100) UNIQUE)
- created_at (TIMESTAMP)

**bookings** - записи
- id (SERIAL PRIMARY KEY)
- user_id (BIGINT)
- username (VARCHAR(100))
- service_id (INTEGER FK -> services.id)
- master (VARCHAR(50))
- booking_date (DATE)
- booking_time (TIME)
- created_at (TIMESTAMP)
- UNIQUE(master, booking_date, booking_time) - предотвращает двойное бронирование

### Автоматическая очистка

Записи старше 3 дней автоматически удаляются каждый день в 03:00 UTC.

Для изменения срока хранения отредактируйте `config.py`:

```python
BOOKING_RETENTION_DAYS = 3  # Количество дней
```

### Слоты времени

- Длительность слота: 30 минут
- Рабочее время зависит от графика мастера
- Прошедшие слоты сегодняшнего дня не показываются

## Логирование

Все события записываются в консоль с уровнем INFO. Для изменения уровня логирования отредактируйте `main.py`:

```python
logging.basicConfig(level=logging.DEBUG)  # Более подробное логирование
```

## Разработка

### Добавление новой услуги

Услуги хранятся в БД. Для добавления:
1. Добавьте название в `database/init_data.py`
2. Перезапустите бота

### Добавление нового мастера

Отредактируйте `config.py`, добавив нового мастера в `MASTERS_SCHEDULE`.

## Лицензия

MIT
